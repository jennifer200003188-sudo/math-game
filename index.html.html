<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤šé …å¼å¤§æŒ‘æˆ°</title>
    <style>
        :root {
            --primary: #6C5CE7;
            --secondary: #FF7675;
            --success: #00B894;
            --warning: #FDCB6E;
            --info: #00CEC9;
            --dark: #2D3436;
            --bg: #F0F3F7;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 10px;
        }

        #game-container {
            background: var(--bg); width: 100%; max-width: 500px; min-height: 600px;
            border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        .screen { display: none; padding: 20px; flex-direction: column; align-items: center; justify-content: center; height: 100%; flex-grow: 1; text-align: center; }
        .active { display: flex; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1 { color: var(--primary); font-size: 2em; margin-bottom: 10px; }
        p { color: #636e72; line-height: 1.6; }

        .btn {
            background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 50px;
            font-size: 1.1em; font-weight: bold; cursor: pointer; transition: 0.3s; width: 100%; margin: 10px 0;
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
        }
        .btn:active { transform: scale(0.98); }

        /* HUD */
        .hud { width: 100%; display: flex; justify-content: space-between; padding: 15px; background: white; border-bottom: 1px solid #ddd; font-weight: bold; color: var(--primary); }

        /* ç¬¬ä¸€é—œï¼šé…å° */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-top: 15px; }
        .card {
            background: white; border: 3px solid #eee; padding: 20px 10px; border-radius: 15px;
            font-size: 1.3em; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .card.selected { border-color: var(--primary); background: #efeeff; }
        .card.matched { visibility: hidden; pointer-events: none; }

        /* é¡Œç›®é¡¯ç¤ºå€ */
        .question-box {
            background: var(--dark); color: #ffeaa7; padding: 25px; border-radius: 20px;
            font-size: 1.5em; width: 100%; margin: 15px 0; letter-spacing: 1px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }

        input[type="text"] {
            width: 100%; padding: 15px; border-radius: 15px; border: 2px solid #ddd;
            font-size: 1.2em; text-align: center; outline: none; margin-bottom: 10px;
        }

        /* ç¬¬ä¸‰é—œé¸é … */
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; width: 100%; }
        .opt-btn {
            background: white; border: 2px solid var(--info); padding: 12px; border-radius: 12px;
            font-weight: bold; cursor: pointer; color: var(--dark);
        }
        .opt-btn:active { background: var(--info); color: white; }

        .feedback { font-weight: bold; margin-top: 10px; min-height: 1.5em; }
        .correct { color: var(--success); }
        .wrong { color: var(--secondary); }

        /* æ‰‹æ©Ÿé©æ‡‰ */
        @media (max-width: 400px) {
            h1 { font-size: 1.7em; }
            .question-box { font-size: 1.2em; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="start-screen" class="screen active">
        <div style="font-size: 4em;">ğŸ§¬</div>
        <h1>å¤šé …å¼å¤§æŒ‘æˆ°</h1>
        <p>æº–å‚™å¥½åˆ†è¾¨åŒé¡é …èˆ‡ç•°é¡é …å—ï¼Ÿ<br>æŒ‘æˆ° 3 å€‹é—œå¡è´å¾—æœ€é«˜åˆ†ï¼</p>
        <button class="btn" onclick="startGame()">é€²å…¥éŠæˆ²</button>
    </div>

    <div id="hud" class="hud" style="display:none;">
        <span>é—œå¡: <span id="level-display">1</span></span>
        <span>åˆ†æ•¸: <span id="score-display">0</span></span>
    </div>

    <div id="level1-screen" class="screen">
        <h3>ç¬¬ä¸€é—œï¼šåŒé¡é …é…å°</h3>
        <p>ğŸ’¡ é»æ“Šå…©å¼µã€Œè®Šæ•¸éƒ¨åˆ†å®Œå…¨ç›¸åŒã€çš„å¡ç‰‡</p>
        <div class="grid" id="l1-grid"></div>
        <div id="fb1" class="feedback"></div>
    </div>

    <div id="level2-screen" class="screen">
        <h3 id="l2-title">ç¬¬äºŒé—œï¼šç²¾ç¢ºè¾¨æ</h3>
        <p id="l2-desc"></p>
        <div class="question-box" id="l2-poly"></div>
        <input type="text" id="l2-input" placeholder="åœ¨æ­¤è¼¸å…¥ç­”æ¡ˆ (å¦‚: -3xy)" autocomplete="off">
        <button class="btn" onclick="checkL2()">æäº¤ç­”æ¡ˆ</button>
        <div id="fb2" class="feedback"></div>
    </div>

    <div id="level3-screen" class="screen">
        <h3>ç¬¬ä¸‰é—œï¼šå¤šé …å¼åŒ–ç°¡</h3>
        <p id="l3-progress">é¡Œç›® 1/5</p>
        <div class="question-box" id="l3-poly"></div>
        <div class="options-grid" id="l3-opts"></div>
        <div id="fb3" class="feedback"></div>
    </div>

    <div id="result-screen" class="screen">
        <h1>ä»»å‹™å®Œæˆï¼</h1>
        <div style="font-size: 5em;">ğŸ†</div>
        <h2 style="font-size: 2.5em; margin: 10px 0;">ç¸½åˆ†: <span id="final-score">0</span></h2>
        <p id="final-msg"></p>
        <button class="btn" onclick="location.reload()">é‡æ–°æŒ‘æˆ° (é¡Œç›®åˆ·æ–°)</button>
    </div>
</div>

<script>
    let score = 0;
    let l1Matches = 0;
    let l2Step = 1; 
    let l3Step = 1;
    let selectedEl = null;
    let currentQ = null;

    // --- é¡Œåº«ç”Ÿæˆ ---
    function generateL1() {
        const pairs = [
            {a: "4xy", b: "-2yx", type: "xy"},
            {a: "-7ab", b: "3ba", type: "ab"},
            {a: "5m", b: "m", type: "m"},
            {a: "9c", b: "-c", type: "c"},
            {a: "-8kz", b: "zk", type: "kz"},
            {a: "abc", b: "-2cba", type: "abc"}
        ];
        let chosen = pairs.sort(() => 0.5 - Math.random()).slice(0, 3);
        let cards = [];
        chosen.forEach(p => { cards.push({t: p.a, id: p.type}, {t: p.b, id: p.type}); });
        return cards.sort(() => 0.5 - Math.random());
    }

    function generateL2(step) {
        const vars = [["xy", "yx"], ["ab", "ba"], ["mn", "nm"]];
        const v = vars[Math.floor(Math.random()*vars.length)];
        const c1 = (Math.floor(Math.random()*9)+2);
        const c2 = (Math.floor(Math.random()*9)+2);

        if (step === 1) {
            return {
                poly: `${c1}${v[0]} - 5z + ${c2}${v[1]} - 3`,
                target: `${c1}${v[0]}`,
                ans: `${c2}${v[1]}`,
                q: `è«‹æ‰¾å‡ºã€Œ${c1}${v[0]}ã€çš„åŒé¡é …ï¼š`
            };
        } else {
            return {
                poly: `-4${v[0]} + 7z - ${v[0]}z + 2`,
                target: `-4${v[0]}`,
                ans: ["7z", `-${v[0]}z`, "2"],
                q: `è«‹æ‰¾å‡ºã€Œ-4${v[0]}ã€çš„ä¸€å€‹ç•°é¡é …ï¼š`
            };
        }
    }

    function generateL3(step) {
        const qset = [
            { p: "4x - 9x", a: "-5x", o: ["5x", "-5x", "-13x", "ç„¡æ³•åŒ–ç°¡"] },
            { p: "12yz + 8zy", a: "20yz", o: ["20yz", "4yz", "20yÂ²zÂ²", "ç„¡æ³•åŒ–ç°¡"] },
            { p: "7x + 3x - 12x", a: "-2x", o: ["10x", "-2x", "2x", "ç„¡æ³•åŒ–ç°¡"] },
            { p: "-2m - 5m + 3", a: "-7m + 3", o: ["-3m + 3", "7m + 3", "-7m + 3", "ç„¡æ³•åŒ–ç°¡"] },
            { p: "z + 6x + 4x - 3z", a: "10x - 2z", o: ["10x - 2z", "10x + 4z", "14xz", "ç„¡æ³•åŒ–ç°¡"] }
        ];
        // éš¨æ©ŸåŒ–ä¿‚æ•¸ä½¿é¡Œç›®æ¯æ¬¡ä¸åŒ
        let q = qset[step-1];
        let r = Math.floor(Math.random()*5)+1;
        // é€™è£¡å¯ä»¥é€²ä¸€æ­¥éš¨æ©ŸåŒ–ï¼Œç‚ºæ±‚ç©©å®šå…ˆä½¿ç”¨é¡Œçµ„
        return q;
    }

    // --- éŠæˆ²é‚è¼¯ ---
    function startGame() {
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('hud').style.display = 'flex';
        initL1();
    }

    function initL1() {
        showScreen('level1-screen');
        const grid = document.getElementById('l1-grid');
        grid.innerHTML = '';
        generateL1().forEach(data => {
            const div = document.createElement('div');
            div.className = 'card'; div.innerText = data.t;
            div.onclick = () => {
                if(div.classList.contains('matched') || div === selectedEl) return;
                div.classList.add('selected');
                if(!selectedEl) { selectedEl = {div, id: data.id}; }
                else {
                    const fb = document.getElementById('fb1');
                    if(selectedEl.id === data.id) {
                        score += 10; l1Matches++;
                        div.classList.add('matched'); selectedEl.div.classList.add('matched');
                        fb.innerHTML = "<span class='correct'>æ­£ç¢ºé…å°ï¼âœ¨</span>";
                    } else {
                        selectedEl.div.classList.remove('selected');
                        fb.innerHTML = "<span class='wrong'>ä¸å°å–”ï¼Œå­—æ¯ä¸å®Œå…¨ä¸€æ¨£ã€‚</span>";
                    }
                    selectedEl = null; updateHUD();
                    if(l1Matches === 3) setTimeout(initL2, 1200);
                }
            };
            grid.appendChild(div);
        });
    }

    function initL2() {
        showScreen('level2-screen');
        document.getElementById('level-display').innerText = "2";
        currentQ = generateL2(l2Step);
        document.getElementById('l2-desc').innerText = currentQ.q;
        document.getElementById('l2-poly').innerText = currentQ.poly;
        document.getElementById('l2-input').value = '';
        document.getElementById('fb2').innerText = '';
    }

    function checkL2() {
        const input = document.getElementById('l2-input').value.trim().toLowerCase().replace(/\s/g,'');
        let isCorrect = false;
        if(Array.isArray(currentQ.ans)) isCorrect = currentQ.ans.some(a => a.toLowerCase() === input);
        else isCorrect = (input === currentQ.ans.toLowerCase());

        const fb = document.getElementById('fb2');
        if(isCorrect) {
            score += 10; fb.innerHTML = "<span class='correct'>ç­”å°äº†ï¼åŒ…å«è² è™Ÿä¹Ÿæ²’é›£å€’ä½ ï¼ğŸŒŸ</span>";
        } else {
            fb.innerHTML = `<span class='wrong'>ç­”éŒ¯äº†ã€‚æ­£ç¢ºç­”æ¡ˆï¼š${Array.isArray(currentQ.ans)?currentQ.ans[0]:currentQ.ans}</span>`;
        }
        updateHUD();
        l2Step++;
        setTimeout(l2Step > 2 ? initL3 : initL2, 2000);
    }

    function initL3() {
        showScreen('level3-screen');
        document.getElementById('level-display').innerText = "3";
        currentQ = generateL3(l3Step);
        document.getElementById('l3-progress').innerText = `é¡Œç›® ${l3Step}/5`;
        document.getElementById('l3-poly').innerText = currentQ.p;
        const optGrid = document.getElementById('l3-opts');
        optGrid.innerHTML = '';
        currentQ.o.sort(() => 0.5 - Math.random()).forEach(opt => {
            const b = document.createElement('div');
            b.className = 'opt-btn'; b.innerText = opt;
            b.onclick = () => {
                if(document.getElementById('fb3').innerText !== '') return;
                const fb = document.getElementById('fb3');
                if(opt === currentQ.a) {
                    score += 10; fb.innerHTML = "<span class='correct'>æ­£ç¢ºåŒ–ç°¡ï¼ğŸ”¥</span>";
                } else {
                    fb.innerHTML = `<span class='wrong'>ç­”éŒ¯äº†ã€‚æ­£ç¢ºæ‡‰ç‚ºï¼š${currentQ.a}</span>`;
                }
                updateHUD();
                l3Step++;
                setTimeout(l3Step > 5 ? showResult : initL3, 2000);
            };
            optGrid.appendChild(b);
        });
        document.getElementById('fb3').innerText = '';
    }

    function updateHUD() {
        document.getElementById('score-display').innerText = score;
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function showResult() {
        document.getElementById('hud').style.display = 'none';
        showScreen('result-screen');
        document.getElementById('final-score').innerText = score;
        document.getElementById('final-msg').innerText = score >= 80 ? "å¤ªå¼·äº†ï¼ä½ æ˜¯å¤šé …å¼å°ˆå®¶ï¼" : "å¾ˆæ£’çš„å˜—è©¦ï¼å†ç©ä¸€æ¬¡æŒ‘æˆ°æ»¿åˆ†å§ã€‚";
    }
</script>
</body>
</html>